> Computer Architecture Honor Class Lab4 Report
>
> 郭耸霄 PB20111712

[TOC]

### 分析分支收益和分支代价

BTB（Branch Target Buffer）和BHT（Branch History Table）是两种常见的分支预测策略。它们的目标是提高处理器的分支预测准确性，从而减少分支指令带来的流水线停顿，提高指令级并行性。

**分支收益：**
分支收益是指分支预测策略能够正确预测分支指令的比例。如果分支预测策略能够准确预测分支指令的结果，那么处理器可以继续执行预测的分支路径上的指令，避免了因等待分支结果而导致的流水线停顿。因此，分支预测策略的分支收益越高，处理器的性能就越好。

- BTB的分支收益：BTB使用分支目标缓冲器，它将最近的分支指令的目标地址存储在缓冲器中。当下一次出现相同的分支指令时，BTB可以直接从缓冲器中获取目标地址，从而避免了对目标地址的计算和预测。如果BTB能够准确预测分支指令的目标地址，那么分支收益会比较高。

- BHT的分支收益：BHT使用分支历史表，它维护了最近的分支指令的历史信息。BHT通过根据当前的分支历史来预测下一次分支指令的结果。如果BHT能够准确预测分支指令的结果，那么分支收益会比较高。

**分支代价：**
分支代价是指分支预测策略引入的额外开销。虽然分支预测能够提高指令级并行性，但是它也需要一定的硬件资源和额外的指令来进行分支预测和恢复。

- BTB的分支代价：BTB需要额外的缓冲器来存储分支目标地址，这需要一定的芯片面积和功耗。此外，BTB还需要在流水线中添加额外的指令来进行分支预测和分支目标的恢复。这些额外的开销会增加处理器的成本和功耗。

- BHT的分支代价：BHT需要维护分支历史表，以及根据历史信息进行预测和更新。这也需要一定的硬件资源和额外的指令来实现。因此，BHT的分支代价也会增加处理器的成本和功耗。

### 统计未使用分支预测和使用分支预测的总周期数及差值

| `CYCLES` |  `btb.S`  |  `bht.S`  | `QuickSort.S` |  `MatMul.S`   |
| :------: | :-------: | :-------: | :-----------: | :-----------: |
|  `None`  |  513(-0)  |  539(-0)  |   55789(-0)   |  296236(-0)   |
|  `BTB`   | 318(-195) | 386(-153) | 56850(+1061)  | 288631(-7605) |
|  `BHT`   | 318(-195) | 368(-171) |  55462(-327)  | 288091(-8145) |

### 统计分支指令数目、动态分支预测正确次数和错误次数

| `HIT_TIMES/BRANCH_TIMES` |    `btb.S`     |    `bht.S`     |   `QuickSort.S`   |    `MatMul.S`     |
| :----------------------: | :------------: | :------------: | :---------------: | :---------------: |
|          `None`          | 1/101(0.9901%) | 11/110(10.00%) | 4936/6596(74.83%) | 274/4624(5.926%)  |
|          `BTB`           | 99/101(98.02%) | 88/110(80.00%) | 4405/6596(66.78%) | 4076/4624(88.15%) |
|          `BHT`           | 99/101(98.02%) | 97/110(88.18%) | 5099/6569(77.62%) | 4346/4624(93.99%) |

### 对比不同策略并分析以上几点的关系

总体来说，BTB和BHT都能提高分支预测的准确性，从而提高处理器性能。但是它们在分支收益和分支代价方面存在一些差异。

- BTB的优点在于它能够较好地处理分支目标的预测，因为它直接存储最近的分支指令的目标地址。当分支目标具有较高的局部性时，BTB可以获得较高的分支收益。另外，BTB的硬件实现相对简单，能够提供较低的分支代价。然而，当分支指令大部分都不进行跳转，或仅进行一次跳转时，BTB甚至没有静态预测（全部预测 PC+4）效果好。

- BHT的优点在于它可以考虑分支指令的历史信息，从而提供更全面的分支预测。BHT可以适应更复杂的分支模式，包括非局部性和循环分支等。在一些复杂的程序中，BHT可能能够提供更高的分支收益。然而，BHT的硬件实现相对复杂，需要更大的存储器和更复杂的预测逻辑，因此分支代价可能会更高一些。

需要注意的是，分支预测策略的效果受到许多因素的影响，包括应用程序的特征、分支模式的复杂性以及硬件实现的细节等。因此，选择适合特定处理器和应用场景的分支预测策略需要综合考虑分支收益和分支代价，并进行评估和调优。



